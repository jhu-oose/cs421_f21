"use strict";(self.webpackChunkcs_421_source=self.webpackChunkcs_421_source||[]).push([[1873],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,h=c["".concat(l,".").concat(d)]||c[d]||u[d]||a;return n?o.createElement(h,i(i({ref:t},m),{},{components:n})):o.createElement(h,i({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3175:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const a={id:"cookies",title:"HTTP cookies",sidebar_label:"HTTP Cookies"},i=void 0,s={unversionedId:"readings/wk5/cookies",id:"readings/wk5/cookies",title:"HTTP cookies",description:"Enter your username",source:"@site/docs/readings/wk5/cookies.md",sourceDirName:"readings/wk5",slug:"/readings/wk5/cookies",permalink:"/cs421/docs/readings/wk5/cookies",draft:!1,editUrl:"https://jhu-oose.github.io/cs421_f21/docs/readings/wk5/cookies.md",tags:[],version:"current",frontMatter:{id:"cookies",title:"HTTP cookies",sidebar_label:"HTTP Cookies"},sidebar:"tutorialSidebar",previous:{title:"Add an employer",permalink:"/cs421/docs/readings/wk5/addemployer"},next:{title:"Model-View-Controller",permalink:"/cs421/docs/readings/wk5/mvc"}},l={},p=[{value:"Enter your username",id:"enter-your-username",level:2},{value:"Me want cookies!",id:"me-want-cookies",level:2},{value:"JBApp",id:"jbapp",level:2}],m={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"enter-your-username"},"Enter your username"),(0,r.kt)("p",null,"Let's toy with the idea of having users login to JBApp. For now, we just ask for their username and welcome them! Before we dive into this, we need to learn about HTTP cookies!"),(0,r.kt)("h2",{id:"me-want-cookies"},"Me want cookies!"),(0,r.kt)("p",null,"In order to capture the username from the user, we use HTTP Post. Then, we redirect that information to HTTP Get. We can do this by capturing ",(0,r.kt)("inlineCode",{parentName:"p"},'req.queryParams("username");')," and store it in our web-server application. It would be, however, an anti-pattern! RESTful API is meant to be ",(0,r.kt)("em",{parentName:"p"},"stateless")," (server should not care about the state of the client, e.g. if client is signed in or not). The generally accepted way to make HTTP appear to be stateful is by storing little bits of data (that are stored on the client) and send on each request to the server. These are called ",(0,r.kt)("strong",{parentName:"p"},"cookies"),". "),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"HTTP Cookie (from ",(0,r.kt)("a",{parentName:"mdxAdmonitionTitle",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies"},"MDN docs"),")"),(0,r.kt)("p",{parentName:"admonition"},"An HTTP cookie (web cookie, browser cookie) is a small piece of data, usually in the form of a randomly encoded text file, that a server sends to the user's web browser. The browser may store it and send it back with later requests to the same server. Typically, it's used to tell if two requests came from the same browser \u2014 keeping a user logged-in, for example. It remembers stateful information for the stateless HTTP protocol.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"from ",(0,r.kt)("a",{parentName:"mdxAdmonitionTitle",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies"},"MDN docs")),(0,r.kt)("p",{parentName:"admonition"},"Cookies are mainly used for three purposes:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Session management: Logins, shopping carts, game scores, or anything else the server should remember"),(0,r.kt)("li",{parentName:"ul"},"Personalization: User preferences, themes, and other settings"),(0,r.kt)("li",{parentName:"ul"},"Tracking: Recording and analyzing user behavior"))),(0,r.kt)("h2",{id:"jbapp"},"JBApp"),(0,r.kt)("p",null,"Now, with that intro, let us add a http post endpoint on ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'post("/", (req, res) -> {\n    String username = req.queryParams("username");\n    res.cookie("username", username);\n    res.redirect("/");\n    return null;\n});\n')),(0,r.kt)("p",null,"As you can see, anytime a post request with a ",(0,r.kt)("inlineCode",{parentName:"p"},"username")," is provided to the homepage, a cookie is set on the response that is sent back to the client. The client will include this cookie in all its future requests to the server."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You browser should include the ",(0,r.kt)("inlineCode",{parentName:"p"},"username")," cookie automatically in all future requests, so you should need not to do anything further about this!")),(0,r.kt)("p",null,"Now, instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"index.html")," that we currently use, let us add ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vm")," under ",(0,r.kt)("inlineCode",{parentName:"p"},"src/main/reources/public")," as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'#set( $title = "Welcome Page" )\n#parse("public/top.vm")\n\n#if($username)\n<h1>Welcome to JBApp</h1>\n<div>\n    <p><a href="/employers">Show all employers</a></p>\n    <p><a href="/addemployer">Add an employer</a></p>\n</div>\n#else\n<h1>Please login first!</h1>\n<form action="/" method="post">\n    <input type="text" placeholder="username" name="username"/>\n    <button>Sign in</button>\n</form>\n#end\n\n#parse("public/bottom.vm")\n')),(0,r.kt)("p",null,"In ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vm")," we check to see if ",(0,r.kt)("inlineCode",{parentName:"p"},"username")," cookie is supplied or not. If not, we show the login HTML ",(0,r.kt)("em",{parentName:"p"},"form"),". Otherwise, we show the front page."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"HTML ",(0,r.kt)("inlineCode",{parentName:"p"},"form")," is a construct to collect data from user. An HTML form contains form elements: text fields, checkboxes, radio buttons, submit buttons, and more.")),(0,r.kt)("p",null,"Finally, we need to update our http get endpoint on ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," route:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'get("/", (req, res) -> {\n    Map<String, Object> model = new HashMap<>();\n    if (req.cookie("username") != null)\n        model.put("username", req.cookie("username"));\n    return new ModelAndView(model, "public/index.vm");\n}, new VelocityTemplateEngine());\n')),(0,r.kt)("p",null,"Here, we check whether the ",(0,r.kt)("inlineCode",{parentName:"p"},"username")," cookie is set or not. If it is, we make it part of the model to be passed into ",(0,r.kt)("inlineCode",{parentName:"p"},"index.vm"),"."),(0,r.kt)("p",null,"Now, if you point your browser to JBApp ",(0,r.kt)("a",{parentName:"p",href:"http://localhost:7000/"},"homepage"),", you should be prompted first to enter a username. Once, you do that, you should be able to see the front page with a welcome message to the username that you entered along with the two links in it."))}u.isMDXComponent=!0}}]);